---
## Author
author:
  name: Иванова Ангелина Олеговна
  degrees: DSc
  orcid: 0000-0002-0877-7063
  email: kulyabov-ds@rudn.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: "Лабораторная работа №7"
subtitle: "НПИбд-01-25 №1032252598"
license: "CC BY"
---

# Цель работы

Целью данной лабораторной работы является изучение команд условного и безусловного переходов, а также приобретение навыков написания программ с использованием переходов и знакомство с назначением и структурой файла листинга.

# Выполнение лабораторной работы

## Задания лабораторной работы

### Реализация переходов в NASM

Создали каталог для программам лабораторной работы № 7, перешли в него и создали файл lab7-1.asm

<figure>
![Создание каталога и файла](image/1.png "Создание каталога и файла"){#fig-001 width=90%}
</figure>

Рассмотрели пример программы с использованием инструкции jmp. Ввели в файл lab7-1.asm текст программы из первого листинга

<figure>
![Измененный файл lab7-1.asm](image/2.png "Измененный файл lab7-1.asm"){#fig-001 width=90%}
</figure>

Создали исполняемый файл и запустили его. Получили корректный результат работы данной программы

<figure>
![Создание исполняемого файла и вывод его работы](image/3.png "Создание исполняемого файла и вывод его работы"){#fig-001 width=90%}
</figure>

Далее изменили программу таким образом, чтобы она выводила сначала ‘Сообщение № 2’, потом ‘Сообщение № 1’ и завершала работу. Для этого в текст программы после вывода сообщения № 2 добавили инструкцию jmp с меткой _label1 (т.е. переход к инструкциям вывода сообщения № 1) и после вывода сообщения № 1 добавим инструкцию jmp с меткой _end (т.е. переход к инструкции call quit). Измените текст программы в соответствии со вторым листингом  

<figure>
![Измененный текст программы](image/4.png "Измененный текст программы"){#fig-001 width=90%}
</figure>

Создали исполняемый файл и проверили его работу

<figure>
![Создание исполняемого файла и вывод его работы](image/5.png "Создание исполняемого файла и вывод его работы"){#fig-001 width=90%}
</figure>

Далее изменили текст программы добавив или изменив инструкции jmp, чтобы вывод программы был следующим:
Сообщение № 3
Сообщение № 2
Сообщение № 1

**Листинг 1:**   
%include 'in_out.asm' ; подключение внешнего файла  
SECTION .data  
msg1: DB 'Сообщение № 1',0  
msg2: DB 'Сообщение № 2',0  
msg3: DB 'Сообщение № 3',0  
SECTION .text  
GLOBAL _start  
_start:  
jmp _label2  
_label1:  
mov eax, msg1 ; Вывод на экран строки  
call sprintLF ; 'Сообщение № 1'  
jmp _end
_label2:
mov eax, msg2 ; Вывод на экран строки  
call sprintLF ; 'Сообщение № 2'  
jmp _label1  
_label3:  
mov eax, msg3 ; Вывод на экран строки  
call sprintLF ; 'Сообщение № 3'  
jmp _label2  
_end:  
call quit ; вызов подпрограммы завершения  

<figure>
![Измененный текст программы](image/6.png "Измененный текст программы"){#fig-001 width=90%}
</figure>

Создали исполняемый файл и проверили его работу

<figure>
![Создание исполняемого файла и вывод его работы](image/7.png "Создание исполняемого файла и вывод его работы"){#fig-001 width=90%}
</figure>

Создали файл lab7-2.asm в каталоге ~/work/arch-pc/lab06 и ввели в него текст программы из второго листинга

<figure>
![Создание файла lab7-2.asm](image/8.png "Создание файла lab7-2.asm"){#fig-001 width=90%}
</figure>

Создали исполняемый файл и проверили его работу для разных значений B.

<figure>
![Создание исполняемого файла и вывод его работы](image/9.png "Создание исполняемого файла и вывод его работы"){#fig-001 width=90%}
</figure>

### Изучение структуры файлы листинга

Создали файл листинга для программы из файла lab7-2.asm

<figure>
![Создание листинга](image/10.png "Создание листинга"){#fig-001 width=90%}
</figure> 

Открыли файл листинга lab7-2.lst с помощью текстового редактора mcedit. 

<figure>
![Открытый листинг](image/11.png "Открытый листинг"){#fig-001 width=90%}
</figure>

Внимательно ознакомились с его форматом и содержимым. Опишем строки под номерами 14, 15 и 17.

1) 14 (номер строки); 000000E8 (адрес, начинается по смещению 000000E8 в сегменте кода); B8[00000000] (машинный код); mov eax,msg1 (исходный текст программы, в котором мы перемещаем адрес метки msg1 в регистр eax. msg1 - адрес строки, которую мы хотим вывести)

2) 15 (номер строки); 000000ED (адрес, начинается по смещению 000000ED в сегменте кода); E81DFFFFFF (машинный код); call sprint (исходный текст программы, в котором мы вызываем подпрограмму печати сообщения)  

3) 17 (номер строки); 000000F2 (адрес, начинается по смещению 000000F2 в сегменте кода); B9[0A000000] (машинный код); mov ecx,B (исходный текст программы, в котором мы записываем адрес введённой переменной в ecx)

Открыли файл с программой lab7-2.asm и удалили в инструкции mov ecx,B операнд B

<figure>
![Удаление в инструкции mov ecx,B операнд B](image/12.png "Удаление в инструкции mov ecx,B операнд B"){#fig-001 width=90%}
</figure>

Выполнили трансляцию с получением файла листинга. Создался исполнительный файл и файл листинга («lab7-2» и «lab7-2.lst»), но при создании в терминале вывело ошибку

<figure>
![Ошибка в терминале](image/13.png "Ошибка в терменале"){#fig-001 width=90%}
</figure> 

Также ошибка отобразилась в листинге
<figure>
![Ошибка в листинге](image/14.png "Ошибка в листинге"){#fig-001 width=90%}
</figure> 

## Задание для самостоятельной работы

1. Написали программу нахождения наименьшей из 3 целочисленных переменных a, b и c.
Значения переменных выбраkb из таблицы в соответствии с 19 вариантом, то есть a=46, b=32, c=74

**Листинг 2**   
  
%include 'in_out.asm'  
  
section .data  
    a dd 46  
    b dd 32  
    c dd 74  
    msg db "Наименьшее число: ",0h  
  
section .bss  
    min resb 10  
  
section .text  
global _start  
  
_start:  
    mov eax, [a]  
    mov ebx, [b]  
    mov ecx, [c]  
    cmp eax, ebx  
    jl check_c  
    mov eax, ebx  
check_c:  
    cmp eax, ecx  
    jl save_result  
    mov eax, ecx  
    
save_result:  
    mov [min], eax  
    mov eax, msg  
    call sprint  
    mov eax, [min]  
    call iprintLF  
    call quit  
    
<figure>
![Работа созданного нами файла](image/15.png "Работа созданного нами файла"){#fig-001 width=90%}
</figure> 

Как можно заметить, программа корректно считает наименьшее число

2. Написали программу, которая для введенных с клавиатуры значений x и a вычисляет значение заданной функции f(x) и выводит результат вычислений. 19 вариант : если x>a f(x)=a+x, если x<=a f(x)=x

**Листинг 3**   
%include 'in_out.asm'  

section .data  
    msgx db 'Введите x = ',0h  
    msga db 'Введите a = ',0h  
    msgresult db 'Результат f(x) = ',0h  
    
section .bss  
    x resb 10  
    a resb 10  
    result resb 10  
    
section .text  
global _start  

_start:  
    mov eax, msgx  
    call sprint  
    mov ecx, x  
    mov edx, 10  
    call sread
    mov eax, x  
    call atoi  
    mov [x], eax  
    mov eax, msga  
    call sprint  
    mov ecx, a  
    mov edx, 10  
    call sread
    mov eax, a  
    call atoi  
    mov [a], eax  
    mov ebx, [x]  
    mov ecx, [a]  
    cmp ebx, ecx  
    jg greater_case  
    mov [result], ebx  
    jmp output_result  
    
greater_case:  
    add ecx, ebx  
    mov [result], ecx  
    
output_result:  
    mov eax, msgresult  
    call sprint  
    mov eax, [result]  
    call iprintLF  
    call quit  

Создали исполняемый файл и проверили его работу для значений x и a
<figure>
![Работа созданного нами файла](image/16.png "Работа созданного нами файла"){#fig-001 width=90%}
</figure> 

# Выводы

Изучили команды условного и безусловного переходов, а также приобрели навыки написания программ с использованием переходов и познакомились с назначением и структурой файла листинга.

::: {#refs}
:::
